[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2018-12-04 12:53:11.207088", 
  "name": "Sales Invoice-Client", 
  "script": "frappe.ui.form.on(\"Sales Invoice Item\", \"qty\", function(frm,cdt,cdn) {\n\tvar item=locals[cur_frm.doc.doctype][cur_frm.doc.name]\n\tvar total_qty=0.0;\n\tvar total_amount=0.0;\n\tconsole.log(item)\n\t$.each(item.items || [], function(i, d) {\n\t\tconsole.log(d.amount)\n\t\ttotal_qty += parseFloat(d.qty);\n\t\ttotal_amount += parseFloat(d.qty)*parseFloat(d.rate)\n\n\n\t})\n\tcur_frm.set_value(\"total_qty\",total_qty);\n\tcur_frm.set_value(\"total_amount\",total_amount);\nsetTimeout(function(){\n\tcur_frm.set_value(\"grand_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"rounded_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"outstanding_amount\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\n\t},3000)\n\n\n})\nfrappe.ui.form.on(\"Sales Invoice Item\", \"rate\", function(frm,cdt,cdn) {\n\tvar item=locals[cur_frm.doc.doctype][cur_frm.doc.name]\n\tvar total_qty=0.0;\n\tvar total_amount=0.0;\n\tconsole.log(item)\n\t$.each(item.items || [], function(i, d) {\n\t\tconsole.log(d.amount)\n\t\ttotal_qty += parseFloat(d.qty);\n\t\ttotal_amount += parseFloat(d.qty)*parseFloat(d.rate)\n\n\n\t})\n\tcur_frm.set_value(\"total_qty\",total_qty);\n\tcur_frm.set_value(\"total_amount\",total_amount);\nsetTimeout(function(){\n\tcur_frm.set_value(\"grand_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"rounded_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"outstanding_amount\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\n\t},3000)\n\n\n})\nfrappe.ui.form.on(\"Sales Invoice Item\", \"items_remove\", function(frm,cdt,cdn) {\n\tvar item=locals[cur_frm.doc.doctype][cur_frm.doc.name]\n\tvar total_qty=0.0;\n\tvar total_amount=0.0;\n\tconsole.log(item)\n\t$.each(item.items || [], function(i, d) {\n\t\tconsole.log(d.amount)\n\t\ttotal_qty += parseFloat(d.qty);\n\t\ttotal_amount += parseFloat(d.qty)*parseFloat(d.rate)\n\n\n\t})\n\tcur_frm.set_value(\"total_qty\",total_qty);\n\tcur_frm.set_value(\"total_amount\",total_amount);\nsetTimeout(function(){\n\tcur_frm.set_value(\"grand_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"rounded_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"outstanding_amount\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\n\t},3000)\n\n\n})\n\nfrappe.ui.form.on(\"Sales Invoice Item\", \"item_code\", function(frm,cdt,cdn) {\nsetTimeout(function(){\tvar item=locals[cur_frm.doc.doctype][cur_frm.doc.name]\n\tvar total_qty=0.0;\n\tvar total_amount=0.0;\n\tconsole.log(item)\n\t$.each(item.items || [], function(i, d) {\n\t\tconsole.log(d.amount)\n\t\ttotal_qty += parseFloat(d.qty);\n\t\ttotal_amount += parseFloat(d.qty)*parseFloat(d.rate)\n\n\n\t})\n\n\tcur_frm.set_value(\"total_qty\",total_qty);\n\tcur_frm.set_value(\"total_amount\",total_amount);\n},2000)\nsetTimeout(function(){\n\tcur_frm.set_value(\"grand_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"rounded_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"outstanding_amount\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\n\t},3000)\n\n\n})\n\n\nfrappe.ui.form.on(\"Empties Only\", \"rate\", function(frm,cdt,cdn) {\n\tvar item=locals[cur_frm.doc.doctype][cur_frm.doc.name]\n\tvar empty=locals[cdt][cdn]\n\tfrappe.model.set_value(cdt,cdn,\"amount\",parseFloat(empty.quantity)*parseFloat(empty.rate))\n\tvar total_qty=0.0;\n\tvar total_amount=0.0;\n\tconsole.log(empty.item)\n        console.log(empty.rate)\n\t$.each(item.empties_only || [], function(i, d) {\n\t\tconsole.log(d.amount)\n        console.log(d.rate)\n\t\ttotal_qty += parseFloat(d.quantity);\n\t\ttotal_amount += parseFloat(d.quantity)*parseFloat(d.rate)\n\t\t\n\n\t})\n\tcur_frm.set_value(\"total_qty1\",total_qty);\n\tcur_frm.set_value(\"total_amount1\",total_amount);\nsetTimeout(function(){\n\tcur_frm.set_value(\"grand_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"rounded_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"outstanding_amount\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\t//cur_frm.set_value(\"base_grand_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\t//cur_frm.set_value(\"base_rounded_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\t\n\n\t},3000)\n\n\n})\nfrappe.ui.form.on(\"Empties Only\", \"quantity\", function(frm,cdt,cdn) {\n\tvar item=locals[cur_frm.doc.doctype][cur_frm.doc.name]\n\tvar empty=locals[cdt][cdn]\n        \n\tfrappe.model.set_value(cdt,cdn,\"amount\",parseFloat(empty.quantity)*parseFloat(empty.rate))\n\tvar total_qty=0.0;\n\tvar total_amount=0.0;\n//\tconsole.log(empty.item)\n\n\t$.each(item.empties_only || [], function(i, d) {\n\t\tconsole.log(d.amount)\n//        console.log(d.rate)\n\t\ttotal_qty += parseFloat(d.quantity);\n\t\ttotal_amount += parseFloat(d.quantity)*parseFloat(d.rate)\n\t\t\n\n\t})\n\tcur_frm.set_value(\"total_qty1\",total_qty);\n\tcur_frm.set_value(\"total_amount1\",total_amount);\nsetTimeout(function(){\n\tcur_frm.set_value(\"grand_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"rounded_total\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\tcur_frm.set_value(\"outstanding_amount\",parseFloat(item.total_amount)+parseFloat(item.total_amount1))\n\n\t},3000)\n\n\n})\n\n\n\n\nfrappe.ui.form.on(\"Empties Only\", {\n\titem: function(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn].item;\n\t\tfrappe.model.set_value(cdt, cdn, 'rate', 0);\n\t\n\t\tvar rate = 0;\n\t\t\n\t\tme.frm.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Item Price\",\n\t\t\t\tfieldname: \"price_list_rate\",\n\t\t\t\tfilters: { item_code: child, price_list : ['RETAIL/VSM', 'BULKBREAKER', 'FIELD RETAIL', 'Empties', 'Standard Selling']},\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tconsole.log(r);\n//\t\t\t\tconsole.log(rt);\n\t\t\t\tif(r.message) {\n\t\t\t\t\trate = parseFloat(r.message.price_list_rate);\n//\t\t\t\t\tconsole.log(rate);\n\t\t\t\t\tconsole.log(cdt+'     '+cdn);\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, 'rate', rate)\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t\n\t}\n})\n", 
  "script_type": "Client"
 }
]